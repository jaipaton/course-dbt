{{
  config(
    materialized='view'
  )
}}

WITH INIT_SEL AS (
    SELECT 
        USER_GUID,
        SUM(ORDER_COST) AS SUM_ORDER_COST,
        SUM(SHIPPING_COST) AS SUM_SHIPPING_COST,
        COUNT(ORDER_GUID) AS COUNT_ORDERS,
        AVG(ORDER_COST) AS AVG_ORDER_COST,
        AVG(SHIPPING_COST) AS AVG_SHIPPING_COST-- ,

        -- MIN(CREATED_AT_UTC) OVER (PARTITION BY USER_GUID ORDER BY CREATED_AT_UTC ASC) AS FIRST_ORDER_UTC,
        -- MAX(CREATED_AT_UTC) OVER (PARTITION BY USER_GUID ORDER BY CREATED_AT_UTC DESC) AS LATEST_ORDER_UTC


    FROM {{ ref('stg_greenery_orders') }} 

    GROUP BY USER_GUID

)
SELECT * 
FROM INIT_SEL


